<div class="survey-container">
  @if (loading()) {
    <div class="survey-card">
      <div class="survey-header">
        <div class="skeleton" style="height: 28px; width: 70%; margin-bottom: 0.75rem;"></div>
        <div class="skeleton" style="height: 18px; width: 90%; margin-bottom: 1rem;"></div>
        <div style="display: flex; gap: 1rem;">
          <div class="skeleton" style="height: 24px; width: 100px; border-radius: 20px;"></div>
          <div class="skeleton" style="height: 24px; width: 60px;"></div>
        </div>
      </div>
      <div class="options-list">
        @for (i of [1, 2, 3]; track i) {
          <div class="skeleton" style="height: 70px; margin-bottom: 0.75rem;"></div>
        }
      </div>
    </div>
  }

  @if (notFound()) {
    <div class="not-found">
      <h2>Survey Not Found</h2>
      <p>This survey may have been deleted or the link is incorrect.</p>
    </div>
  }

  @if (survey(); as s) {
    <div class="survey-card">
      <div class="survey-header">
        <h1>{{ s.title }}</h1>
        @if (s.description) {
          <p class="description">{{ s.description }}</p>
        }
        <div class="meta">
          <span class="badge" [class.active]="s.isActive" [class.closed]="!s.isActive">
            {{ s.isActive ? getTimeRemaining() : 'Closed' }}
          </span>
          <span class="vote-count">{{ s.totalVotes }} vote{{ s.totalVotes !== 1 ? 's' : '' }}</span>
          <span class="mode">{{ s.selectionMode === 'Multiple' ? 'Select multiple' : 'Select one' }}</span>
        </div>
      </div>

      <div class="options-list">
        @for (option of s.options; track option.id) {
          <div
            class="option"
            [class.selected]="isSelected(option.id)"
            [class.winner]="option.isWinner"
            [class.disabled]="!s.isActive"
            (click)="toggleOption(option.id)">
            <div class="option-content">
              <div class="option-select">
                @if (s.selectionMode === 'Single') {
                  <input
                    type="radio"
                    [checked]="isSelected(option.id)"
                    [disabled]="!s.isActive"
                    (click)="$event.stopPropagation()">
                } @else {
                  <input
                    type="checkbox"
                    [checked]="isSelected(option.id)"
                    [disabled]="!s.isActive"
                    (click)="$event.stopPropagation()">
                }
              </div>
              <div class="option-text">
                <span class="option-label">{{ option.displayText }}</span>
                @if (option.isWinner) {
                  <span class="winner-badge">Winner</span>
                }
              </div>
              <div class="option-votes">
                <span class="vote-number">{{ option.voteCount }}</span>
              </div>
            </div>
            <div class="progress-bar">
              <div class="progress" [style.width.%]="getVotePercentage(option.voteCount)"></div>
            </div>
          </div>
        }
      </div>

      @if (s.isActive) {
        <div class="actions">
          <div class="name-input">
            <label for="voterName">Your name</label>
            <input
              type="text"
              id="voterName"
              [value]="voterName()"
              (input)="voterName.set($any($event.target).value)"
              placeholder="Enter your name"
              [disabled]="submitting()">
          </div>
          <button
            class="submit-btn"
            [disabled]="selectedOptions().size === 0 || submitting() || !voterName().trim()"
            (click)="submitVote()">
            @if (submitting()) {
              <span class="spinner"></span>
              <span>Submitting...</span>
            } @else {
              {{ s.userHasVoted ? 'Update Vote' : 'Submit Vote' }}
            }
          </button>
        </div>
      }
    </div>
  }
</div>
